<h2 class="mb-4 text-primary">Leave Management</h2>

<!-- Staff-only section -->
<div *ngIf="role === 'STAFF'">
  <div class="leave-mgmt-container">

  <div class="header d-flex justify-content-between align-items-center mb-3">
    <h3>My Leaves</h3>
    <button class="btn btn-primary" (click)="toggleApplyForm()">
      {{ showApplyForm ? 'Close' : 'Apply New Leave' }}
    </button>
  </div>

  <!-- Apply Leave Form -->
  <div *ngIf="showApplyForm" class="card p-3 mb-3">
    <form [formGroup]="applyLeaveForm" (ngSubmit)="applyLeave()">
      <div class="row g-2">
        <div class="col-md-4">
          <input type="date" class="form-control" placeholder="From Date" formControlName="fromDate">
        </div>
        <div class="col-md-4">
          <input type="date" class="form-control" placeholder="To Date" formControlName="toDate">
        </div>
        <div class="col-md-4">
          <input type="text" class="form-control" placeholder="Reason" formControlName="reason">
        </div>
      </div>
      <button class="btn btn-success mt-2" type="submit">Apply Leave</button>
    </form>
  </div>

  <!-- Leaves Table -->
  <table class="table table-bordered table-striped">
    <thead class="table-dark">
      <tr>
        <th>Sr No.</th>
        <th>From Date</th>
        <th>To Date</th>
        <th>Reason</th>
        <th>Status</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let leave of leaves; let i = index">
        <td>{{ i + 1 }}</td>
        <td>{{ leave.fromDate }}</td>
        <td>{{ leave.toDate }}</td>
        <td>{{ leave.reason }}</td>
        <td>{{ leave.status }}</td>
        <td>
          <button class="btn btn-info btn-sm" (click)="viewLeave(leave)">View</button>
        </td>
      </tr>
      <tr *ngIf="leaves.length === 0">
        <td colspan="6" class="text-center">No leaves applied yet.</td>
      </tr>
    </tbody>
  </table>

</div>

<!-- View Leave Modal -->
<!-- <div *ngIf="showViewModal" class="modal-backdrop">
  <div class="modal-card">
    <h4>Leave Details</h4>
    <p><strong>Name:</strong> {{ selectedLeave.name }}</p>
    <p><strong>From Date:</strong> {{ selectedLeave.fromDate }}</p>
    <p><strong>To Date:</strong> {{ selectedLeave.toDate }}</p>
    <p><strong>Reason:</strong> {{ selectedLeave.reason }}</p>
    <p><strong>Status:</strong> {{ selectedLeave.status }}</p>
    <button class="btn btn-secondary" (click)="closeView()">Close</button>
  </div>
</div> -->

</div>

<!-- HOD-only section -->
<!-- HOD VIEW -->
<div *ngIf="role === 'HOD'">

  <h3>Staff Leave Requests ({{ user.department }})</h3>

  <table class="table table-bordered table-striped mt-3">
    <thead class="table-dark">
      <tr>
        <th>#</th>
        <th>Staff Name</th>
        <th>From</th>
        <th>To</th>
        <th>Reason</th>
        <th>Status</th>
        <th>Action</th>
      </tr>
    </thead>

    <tbody>
      <tr *ngFor="let l of leaves; index as i">
        <td>{{ i+1 }}</td>
        <td>{{ l.name }}</td>
        <td>{{ l.fromDate }}</td>
        <td>{{ l.toDate }}</td>
        <td>{{ l.reason }}</td>
        <td>{{ l.status }}</td>
        <td>
          <button class="btn btn-info btn-sm" (click)="viewLeave(l)">View</button>
        </td>
      </tr>
    </tbody>
  </table>
</div>


<div *ngIf="showViewModal" class="modal-backdrop">
  <div class="modal-card">
    <h4>Leave Details</h4>
    <p><strong>Name:</strong> {{ selectedLeave.name }}</p>
    <p><strong>From:</strong> {{ selectedLeave.fromDate }}</p>
    <p><strong>To:</strong> {{ selectedLeave.toDate }}</p>
    <p><strong>Reason:</strong> {{ selectedLeave.reason }}</p>
    <p><strong>Status:</strong> {{ selectedLeave.status }}</p>

    <div *ngIf="role === 'HOD' && selectedLeave.status === 'Pending'">
      <button class="btn btn-success me-2" (click)="approveLeave()">Approve</button>
      <button class="btn btn-danger" (click)="rejectLeave()">Reject</button>
    </div>

    <button class="btn btn-secondary mt-3" (click)="closeView()">Close</button>
  </div>
</div>


